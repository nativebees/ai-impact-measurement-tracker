<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Impact Measurement Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f9fafd; color: #222; margin: 0; padding: 0; }
    .container { max-width: 1100px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px #e3e8ee; padding: 32px; }
    h1 { color: #1683d5; }
    table { border-collapse: collapse; width: 100%; background: #fff; margin-top: 18px;}
    th, td { border: 1px solid #e3e8ee; padding: 12px 8px; text-align: left; }
    th { background: #f3f6fa; color: #1683d5; }
    tr:nth-child(even) { background: #f7fafd; }
    .loading, .error { color: #1683d5; font-weight: 500; padding: 20px 0;}
    @media (max-width: 700px) {
      .container { padding: 8px; }
      table, th, td { font-size: 13px; }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>AI Impact Measurement Tracker</h1>
  <div id="info">
    <p>This dashboard displays real-time data from the <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vQtbQC16y1s40evGp4-c1dfZ7wYGecqZkbdvz_CglP8l6l_WjfBeNPNvHKjXusZar4PEA97733RkAlr/pubhtml" target="_blank">AI Impact Measurement Google Sheet</a>. Update the Sheet and this page will reflect changes automatically for all users.</p>
  </div>
  <div id="table-container" class="loading">Loading data from Google Sheets…</div>
</div>
<script>
const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQtbQC16y1s40evGp4-c1dfZ7wYGecqZkbdvz_CglP8l6l_WjfBeNPNvHKjXusZar4PEA97733RkAlr/pub?output=csv";

function csvToArray(str, delimiter = ",") {
  const rows = str.replace(/\r/g, '').split('\n');
  const headers = rows.shift().split(delimiter).map(h => h.trim());
  return rows
    .filter(row => row.trim() !== "")
    .map(row => {
      const values = [];
      let value = '';
      let inQuotes = false;
      for (let i = 0; i < row.length; i++) {
        const char = row[i];
        if (char === '"' && row[i + 1] === '"') {
          value += '"';
          i++;
        } else if (char === '"') {
          inQuotes = !inQuotes;
        } else if (char === delimiter && !inQuotes) {
          values.push(value);
          value = '';
        } else {
          value += char;
        }
      }
      values.push(value);
      // Pad if row is shorter than header
      while (values.length < headers.length) values.push('');
      return Object.fromEntries(headers.map((h, i) => [h, values[i].trim()]));
    });
}

function renderTable(data) {
  if (!data.length) return '<p>No data found.</p>';
  const headers = Object.keys(data[0]);
  let html = '<table><thead><tr>' +
    headers.map(h => `<th>${h}</th>`).join('') +
    '</tr></thead><tbody>';
  data.forEach(row => {
    html += '<tr>' + headers.map(h => `<td>${row[h] || ""}</td>`).join('') + '</tr>';
  });
  html += '</tbody></table>';
  return html;
}

async function loadSheet() {
  const container = document.getElementById('table-container');
  container.className = "loading";
  container.textContent = "Loading data from Google Sheets…";
  try {
    const res = await fetch(SHEET_CSV_URL);
    if (!res.ok) throw new Error("Sheet unavailable");
    const csv = await res.text();
    const data = csvToArray(csv);
    container.className = "";
    container.innerHTML = renderTable(data);
  } catch (err) {
    container.className = "error";
    container.textContent = "Failed to load data. Please check your internet connection or Sheet link.";
  }
}
window.onload = loadSheet;
</script>
</body>
</html>
